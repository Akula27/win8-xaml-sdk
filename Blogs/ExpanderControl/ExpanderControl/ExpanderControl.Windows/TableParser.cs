using Newtonsoft.Json.Linq;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Net.Http;
using System.Threading.Tasks;

namespace ExpanderControl.ViewModel
{
	public class TableParser
	{
		async public static Task<JObject> GetJsonObjectAsync(string url)
		{
			var client = new HttpClient();
			var response = await client.GetAsync(new Uri(url));
			var rawResult = await response.Content.ReadAsStringAsync();
			//var rawResult = @"google.visualization.Query.setResponse({'version':'0.6','reqId':'0','status':'ok','sig':'950291702','table':{'cols':[{'id':'A','label':'Position','type':'number','pattern':'General'},{'id':'B','label':'Team','type':'string'},{'id':'C','label':'Played Matches','type':'number','pattern':'General'},{'id':'D','label':'Total Wins','type':'number','pattern':'General'},{'id':'E','label':'Total Draws','type':'number','pattern':'General'},{'id':'F','label':'Total Losses','type':'number','pattern':'General'},{'id':'G','label':'Total Goals Scored','type':'number','pattern':'General'},{'id':'H','label':'Total Goals Received','type':'number','pattern':'General'},{'id':'I','label':'Home Wins','type':'number','pattern':'General'},{'id':'J','label':'Home Draws','type':'number','pattern':'General'},{'id':'K','label':'Home Losses','type':'number','pattern':'General'},{'id':'L','label':'Home Goals Scored','type':'number','pattern':'General'},{'id':'M','label':'Home Goals Received','type':'number','pattern':'General'},{'id':'N','label':'Away Wins','type':'number','pattern':'General'},{'id':'O','label':'Away Draws','type':'number','pattern':'General'},{'id':'P','label':'Away Losses','type':'number','pattern':'General'},{'id':'Q','label':'Away Goals Scored','type':'number','pattern':'General'},{'id':'R','label':'Away Goals Received','type':'number','pattern':'General'},{'id':'S','label':'Average Goals per Match','type':'number','pattern':'General'},{'id':'T','label':'Points','type':'number','pattern':'General'}],'rows':[{'c':[{'v':1.0,'f':'1'},{'v':'Manchester United'},{'v':38.0,'f':'38'},{'v':28.0,'f':'28'},{'v':7.0,'f':'7'},{'v':3.0,'f':'3'},{'v':97.0,'f':'97'},{'v':45.0,'f':'45'},{'v':15.0,'f':'15'},{'v':4.0,'f':'4'},{'v':0.0,'f':'0'},{'v':59.0,'f':'59'},{'v':16.0,'f':'16'},{'v':13.0,'f':'13'},{'v':3.0,'f':'3'},{'v':3.0,'f':'3'},{'v':38.0,'f':'38'},{'v':29.0,'f':'29'},null,{'v':91.0,'f':'91'}]},{'c':[{'v':2.0,'f':'2'},{'v':'Arsenal'},{'v':38.0,'f':'38'},{'v':22.0,'f':'22'},{'v':7.0,'f':'7'},{'v':9.0,'f':'9'},{'v':73.0,'f':'73'},{'v':43.0,'f':'43'},{'v':14.0,'f':'14'},{'v':3.0,'f':'3'},{'v':2.0,'f':'2'},{'v':42.0,'f':'42'},{'v':17.0,'f':'17'},{'v':8.0,'f':'8'},{'v':4.0,'f':'4'},{'v':7.0,'f':'7'},{'v':31.0,'f':'31'},{'v':26.0,'f':'26'},null,{'v':73.0,'f':'73'}]},{'c':[{'v':3.0,'f':'3'},{'v':'Leeds United'},{'v':38.0,'f':'38'},{'v':21.0,'f':'21'},{'v':6.0,'f':'6'},{'v':11.0,'f':'11'},{'v':58.0,'f':'58'},{'v':43.0,'f':'43'},{'v':12.0,'f':'12'},{'v':2.0,'f':'2'},{'v':5.0,'f':'5'},{'v':29.0,'f':'29'},{'v':18.0,'f':'18'},{'v':9.0,'f':'9'},{'v':4.0,'f':'4'},{'v':6.0,'f':'6'},{'v':29.0,'f':'29'},{'v':25.0,'f':'25'},null,{'v':69.0,'f':'69'}]},{'c':[{'v':4.0,'f':'4'},{'v':'Liverpool'},{'v':38.0,'f':'38'},{'v':19.0,'f':'19'},{'v':10.0,'f':'10'},{'v':9.0,'f':'9'},{'v':51.0,'f':'51'},{'v':30.0,'f':'30'},{'v':11.0,'f':'11'},{'v':4.0,'f':'4'},{'v':4.0,'f':'4'},{'v':28.0,'f':'28'},{'v':13.0,'f':'13'},{'v':8.0,'f':'8'},{'v':6.0,'f':'6'},{'v':5.0,'f':'5'},{'v':23.0,'f':'23'},{'v':17.0,'f':'17'},null,{'v':67.0,'f':'67'}]},{'c':[{'v':5.0,'f':'5'},{'v':'Chelsea'},{'v':38.0,'f':'38'},{'v':18.0,'f':'18'},{'v':11.0,'f':'11'},{'v':9.0,'f':'9'},{'v':53.0,'f':'53'},{'v':34.0,'f':'34'},{'v':12.0,'f':'12'},{'v':5.0,'f':'5'},{'v':2.0,'f':'2'},{'v':35.0,'f':'35'},{'v':12.0,'f':'12'},{'v':6.0,'f':'6'},{'v':6.0,'f':'6'},{'v':7.0,'f':'7'},{'v':18.0,'f':'18'},{'v':22.0,'f':'22'},null,{'v':65.0,'f':'65'}]},{'c':[{'v':6.0,'f':'6'},{'v':'Aston Villa'},{'v':38.0,'f':'38'},{'v':15.0,'f':'15'},{'v':13.0,'f':'13'},{'v':10.0,'f':'10'},{'v':46.0,'f':'46'},{'v':35.0,'f':'35'},{'v':8.0,'f':'8'},{'v':8.0,'f':'8'},{'v':3.0,'f':'3'},{'v':23.0,'f':'23'},{'v':12.0,'f':'12'},{'v':7.0,'f':'7'},{'v':5.0,'f':'5'},{'v':7.0,'f':'7'},{'v':23.0,'f':'23'},{'v':23.0,'f':'23'},null,{'v':58.0,'f':'58'}]},{'c':[{'v':7.0,'f':'7'},{'v':'Sunderland'},{'v':38.0,'f':'38'},{'v':16.0,'f':'16'},{'v':10.0,'f':'10'},{'v':12.0,'f':'12'},{'v':57.0,'f':'57'},{'v':56.0,'f':'56'},{'v':10.0,'f':'10'},{'v':6.0,'f':'6'},{'v':3.0,'f':'3'},{'v':28.0,'f':'28'},{'v':17.0,'f':'17'},{'v':6.0,'f':'6'},{'v':4.0,'f':'4'},{'v':9.0,'f':'9'},{'v':29.0,'f':'29'},{'v':39.0,'f':'39'},null,{'v':58.0,'f':'58'}]},{'c':[{'v':8.0,'f':'8'},{'v':'Leicester City'},{'v':38.0,'f':'38'},{'v':16.0,'f':'16'},{'v':7.0,'f':'7'},{'v':15.0,'f':'15'},{'v':55.0,'f':'55'},{'v':55.0,'f':'55'},{'v':10.0,'f':'10'},{'v':3.0,'f':'3'},{'v':6.0,'f':'6'},{'v':31.0,'f':'31'},{'v':24.0,'f':'24'},{'v':6.0,'f':'6'},{'v':4.0,'f':'4'},{'v':9.0,'f':'9'},{'v':24.0,'f':'24'},{'v':31.0,'f':'31'},{'v':0.0,'f':'0'},{'v':55.0,'f':'55'}]},{'c':[{'v':9.0,'f':'9'},{'v':'West Ham United'},{'v':38.0,'f':'38'},{'v':15.0,'f':'15'},{'v':10.0,'f':'10'},{'v':13.0,'f':'13'},{'v':52.0,'f':'52'},{'v':53.0,'f':'53'},{'v':11.0,'f':'11'},{'v':5.0,'f':'5'},{'v':3.0,'f':'3'},{'v':32.0,'f':'32'},{'v':23.0,'f':'23'},{'v':4.0,'f':'4'},{'v':5.0,'f':'5'},{'v':10.0,'f':'10'},{'v':20.0,'f':'20'},{'v':30.0,'f':'30'},{'v':-1.0,'f':'-1'},{'v':55.0,'f':'55'}]},{'c':[{'v':10.0,'f':'10'},{'v':'Tottenham Hotspur'},{'v':38.0,'f':'38'},{'v':15.0,'f':'15'},{'v':8.0,'f':'8'},{'v':15.0,'f':'15'},{'v':57.0,'f':'57'},{'v':49.0,'f':'49'},{'v':10.0,'f':'10'},{'v':3.0,'f':'3'},{'v':6.0,'f':'6'},{'v':40.0,'f':'40'},{'v':26.0,'f':'26'},{'v':5.0,'f':'5'},{'v':5.0,'f':'5'},{'v':9.0,'f':'9'},{'v':17.0,'f':'17'},{'v':23.0,'f':'23'},null,{'v':53.0,'f':'53'}]},{'c':[{'v':11.0,'f':'11'},{'v':'Newcastle United'},{'v':38.0,'f':'38'},{'v':14.0,'f':'14'},{'v':10.0,'f':'10'},{'v':14.0,'f':'14'},{'v':63.0,'f':'63'},{'v':54.0,'f':'54'},{'v':10.0,'f':'10'},{'v':5.0,'f':'5'},{'v':4.0,'f':'4'},{'v':42.0,'f':'42'},{'v':20.0,'f':'20'},{'v':4.0,'f':'4'},{'v':5.0,'f':'5'},{'v':10.0,'f':'10'},{'v':21.0,'f':'21'},{'v':34.0,'f':'34'},null,{'v':52.0,'f':'52'}]},{'c':[{'v':12.0,'f':'12'},{'v':'Middlesbrough'},{'v':38.0,'f':'38'},{'v':14.0,'f':'14'},{'v':10.0,'f':'10'},{'v':14.0,'f':'14'},{'v':46.0,'f':'46'},{'v':52.0,'f':'52'},{'v':8.0,'f':'8'},{'v':5.0,'f':'5'},{'v':6.0,'f':'6'},{'v':23.0,'f':'23'},{'v':26.0,'f':'26'},{'v':6.0,'f':'6'},{'v':5.0,'f':'5'},{'v':8.0,'f':'8'},{'v':23.0,'f':'23'},{'v':26.0,'f':'26'},{'v':-6.0,'f':'-6'},{'v':52.0,'f':'52'}]},{'c':[{'v':13.0,'f':'13'},{'v':'Everton'},{'v':38.0,'f':'38'},{'v':12.0,'f':'12'},{'v':14.0,'f':'14'},{'v':12.0,'f':'12'},{'v':59.0,'f':'59'},{'v':49.0,'f':'49'},{'v':7.0,'f':'7'},{'v':9.0,'f':'9'},{'v':3.0,'f':'3'},{'v':36.0,'f':'36'},{'v':21.0,'f':'21'},{'v':5.0,'f':'5'},{'v':5.0,'f':'5'},{'v':9.0,'f':'9'},{'v':23.0,'f':'23'},{'v':28.0,'f':'28'},null,{'v':50.0,'f':'50'}]},{'c':[{'v':14.0,'f':'14'},{'v':'Coventry City'},{'v':38.0,'f':'38'},{'v':12.0,'f':'12'},{'v':8.0,'f':'8'},{'v':18.0,'f':'18'},{'v':47.0,'f':'47'},{'v':54.0,'f':'54'},{'v':12.0,'f':'12'},{'v':1.0,'f':'1'},{'v':6.0,'f':'6'},{'v':38.0,'f':'38'},{'v':22.0,'f':'22'},{'v':0.0,'f':'0'},{'v':7.0,'f':'7'},{'v':12.0,'f':'12'},{'v':9.0,'f':'9'},{'v':32.0,'f':'32'},{'v':-7.0,'f':'-7'},{'v':44.0,'f':'44'}]},{'c':[{'v':15.0,'f':'15'},{'v':'Southampton'},{'v':38.0,'f':'38'},{'v':12.0,'f':'12'},{'v':8.0,'f':'8'},{'v':18.0,'f':'18'},{'v':45.0,'f':'45'},{'v':62.0,'f':'62'},{'v':8.0,'f':'8'},{'v':4.0,'f':'4'},{'v':7.0,'f':'7'},{'v':26.0,'f':'26'},{'v':22.0,'f':'22'},{'v':4.0,'f':'4'},{'v':4.0,'f':'4'},{'v':11.0,'f':'11'},{'v':19.0,'f':'19'},{'v':40.0,'f':'40'},{'v':-17.0,'f':'-17'},{'v':44.0,'f':'44'}]},{'c':[{'v':16.0,'f':'16'},{'v':'Derby County'},{'v':38.0,'f':'38'},{'v':9.0,'f':'9'},{'v':11.0,'f':'11'},{'v':18.0,'f':'18'},{'v':44.0,'f':'44'},{'v':57.0,'f':'57'},{'v':6.0,'f':'6'},{'v':3.0,'f':'3'},{'v':10.0,'f':'10'},{'v':22.0,'f':'22'},{'v':25.0,'f':'25'},{'v':3.0,'f':'3'},{'v':8.0,'f':'8'},{'v':8.0,'f':'8'},{'v':22.0,'f':'22'},{'v':32.0,'f':'32'},{'v':-13.0,'f':'-13'},{'v':38.0,'f':'38'}]},{'c':[{'v':17.0,'f':'17'},{'v':'Bradford City'},{'v':38.0,'f':'38'},{'v':9.0,'f':'9'},{'v':9.0,'f':'9'},{'v':20.0,'f':'20'},{'v':38.0,'f':'38'},{'v':68.0,'f':'68'},{'v':6.0,'f':'6'},{'v':8.0,'f':'8'},{'v':5.0,'f':'5'},{'v':26.0,'f':'26'},{'v':29.0,'f':'29'},{'v':3.0,'f':'3'},{'v':1.0,'f':'1'},{'v':15.0,'f':'15'},{'v':12.0,'f':'12'},{'v':39.0,'f':'39'},{'v':-30.0,'f':'-30'},{'v':36.0,'f':'36'}]},{'c':[{'v':18.0,'f':'18'},{'v':'Wimbledon'},{'v':38.0,'f':'38'},{'v':7.0,'f':'7'},{'v':12.0,'f':'12'},{'v':19.0,'f':'19'},{'v':46.0,'f':'46'},{'v':74.0,'f':'74'},{'v':6.0,'f':'6'},{'v':7.0,'f':'7'},{'v':6.0,'f':'6'},{'v':30.0,'f':'30'},{'v':28.0,'f':'28'},{'v':1.0,'f':'1'},{'v':5.0,'f':'5'},{'v':13.0,'f':'13'},{'v':16.0,'f':'16'},{'v':46.0,'f':'46'},{'v':-28.0,'f':'-28'},{'v':33.0,'f':'33'}]},{'c':[{'v':19.0,'f':'19'},{'v':'Sheffield Wednesday'},{'v':38.0,'f':'38'},{'v':8.0,'f':'8'},{'v':7.0,'f':'7'},{'v':23.0,'f':'23'},{'v':38.0,'f':'38'},{'v':70.0,'f':'70'},{'v':6.0,'f':'6'},{'v':3.0,'f':'3'},{'v':10.0,'f':'10'},{'v':21.0,'f':'21'},{'v':23.0,'f':'23'},{'v':2.0,'f':'2'},{'v':4.0,'f':'4'},{'v':13.0,'f':'13'},{'v':17.0,'f':'17'},{'v':47.0,'f':'47'},{'v':-32.0,'f':'-32'},{'v':31.0,'f':'31'}]},{'c':[{'v':20.0,'f':'20'},{'v':'Watford'},{'v':38.0,'f':'38'},{'v':6.0,'f':'6'},{'v':6.0,'f':'6'},{'v':26.0,'f':'26'},{'v':35.0,'f':'35'},{'v':77.0,'f':'77'},{'v':5.0,'f':'5'},{'v':4.0,'f':'4'},{'v':10.0,'f':'10'},{'v':24.0,'f':'24'},{'v':31.0,'f':'31'},{'v':1.0,'f':'1'},{'v':2.0,'f':'2'},{'v':16.0,'f':'16'},{'v':11.0,'f':'11'},{'v':46.0,'f':'46'},{'v':-42.0,'f':'-42'},{'v':24.0,'f':'24'}]}]}});";
			var startIndex = rawResult.IndexOf('{');
			var length = rawResult.Length - startIndex - 2;

			var jsonResponse = rawResult.Substring(startIndex, length);
			JObject o = JObject.Parse(jsonResponse);
			return o;
		}

		public static List<Team> GetTeams(JObject obj)
		{
			List<Team> teams = new List<Team>();

			for (int row = 0; row < obj["table"]["rows"].Count(); row++)
			{
				string position = obj["table"]["rows"][row]["c"][0]["v"].ToString();
				string name = obj["table"]["rows"][row]["c"][1]["v"].ToString();
				string wins = obj["table"]["rows"][row]["c"][3]["v"].ToString();
				string draws = obj["table"]["rows"][row]["c"][4]["v"].ToString();
				string losses = obj["table"]["rows"][row]["c"][5]["v"].ToString();
				string scored = obj["table"]["rows"][row]["c"][6]["v"].ToString();
				string received = obj["table"]["rows"][row]["c"][7]["v"].ToString();
				string points = obj["table"]["rows"][row]["c"][19]["v"].ToString();

				Team newTeam = new Team(int.Parse(position), name, int.Parse(wins), int.Parse(draws), int.Parse(losses), int.Parse(scored), int.Parse(received), int.Parse(points));
				teams.Add(newTeam);
			}

			return teams;
		}
	}
}
